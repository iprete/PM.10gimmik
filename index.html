<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rune Puzzle</title>  <!-- === 스타일 === -->  <style>
    /* 레이아웃 */
    html, body {
      height: 100%; margin: 0;
      display: flex; align-items: center; justify-content: center;
      background: #000; color: #fff; font-family: sans-serif;
    }

    /* 공통 뷰 */
    .view { display: none; flex-direction: column; align-items: center; gap: 24px; }
    .view.active { display: flex; }

    /* 난이도 메뉴 */
    #menu h1 { font-size: 2.6rem; margin: 0; }
    .rules { font-size: .9rem; text-align: center; line-height: 1.4; opacity: .9; }
    .level-btn {
      min-width: 130px; height: 64px; margin: 4px;
      background: #222; color: #fff; border: none; border-radius: 6px;
      font-size: 1.1rem; cursor: pointer;
    }
    .level-btn:hover, #homeBtn:hover, #fsBtn:hover, #resetBtn:hover { background: #555; }

    /* 색별 반경 레전드 */
    #legend { display: flex; gap: 18px; margin-top: 10px; }
    .legend-block { display: grid; grid-template-columns: repeat(7, 10px); grid-auto-rows: 10px; gap: 1px; }
    .square      { width: 10px; height: 10px; background: #333; }
    .legend-title{ font-size: .75rem; opacity: .8; margin-top: 3px; text-align: center; }

    /* 게임 화면 상단 버튼 */
    #game { gap: 20px; position: relative; }
    #homeBtn, #fsBtn {
      position: absolute; top: -44px; padding: 6px 12px;
      background: #444; border: none; border-radius: 6px; color: #fff; cursor: pointer;
    }
    #homeBtn { left: 0; }
    #fsBtn   { right: 0; }
    #resetBtn{ padding: 6px 14px; background: #444; border: none; border-radius: 6px; color: #fff; cursor: pointer; }

    /* 보드 */
    #board { display: grid; gap: 6px; }
    .cell  { width: 60px; height: 60px; box-shadow: 0 0 4px rgba(255,255,255,.15); transition: filter .1s; }
    .cell:hover { filter: brightness(1.25); }

    /* 색 */
    .c0{ background:#ff0033; } /* 빨 */
    .c1{ background:#ffd800; } /* 노 */
    .c2{ background:#00ff33; } /* 초 */
    .c3{ background:#0066ff; } /* 파 */

    /* 클릭 잔여 */
    #dots { display: flex; gap: 8px; }
    .dot  { width: 14px; height: 14px; background: #fff; border-radius: 50%; }
  </style></head>
<body>  <!-- ===== 난이도 메뉴 ===== -->  <div id="menu" class="view active">
    <h1>난이도 선택</h1><div class="rules">
  <strong>규칙</strong> : 클릭한 칸은 <em>빨 → 노 → 초 → 파 → 빨</em> 순으로 바뀌며<br>
  맨해튼 거리 ≤ 색별 반경(빨1·노2·초3·파4)인 주변 칸도 함께 변합니다.<br>
  남은 클릭 수는 위 점(dot)으로 표시되고, 모든 칸 색이 같아지면 성공!
</div>

<div id="legend"></div>
<div id="levels"></div>

  </div>  <!-- ===== 게임 화면 ===== -->  <div id="game" class="view">
    <button id="homeBtn">HOME</button>
    <button id="fsBtn">⤢</button><div id="dots"></div>
<div id="board"></div>
<button id="resetBtn">RESET</button>

  </div>  <!-- ===== 스크립트 ===== -->  <script>
    /***************** 퍼즐 정의 *****************/
    const puzzles = {
      veryeasy: { size: 7, max: 2, sol: [[6,0],[0,6]] },
      normal  : { size: 5, max: 3, sol: [[1,1],[4,4],[0,2]] },
      hard    : { size: 5, max: 5, sol: [[2,1],[3,0],[0,4],[4,3],[1,2]] },
      extreme : { size: 7, max: 5, sol: [[5,5],[3,2],[0,6],[2,1],[4,4]] },
      infinite: { size: 7, max: 0, sol: [], inf: true }
    };
    const order = ['veryeasy','normal','hard','extreme','infinite'];
    const names = {veryeasy:'매우쉬움', normal:'보통', hard:'상', extreme:'극상', infinite:'무한'};

    /***************** DOM 요소 *****************/
    const menu    = document.getElementById('menu'),
          game    = document.getElementById('game'),
          legend  = document.getElementById('legend'),
          levels  = document.getElementById('levels'),
          homeBtn = document.getElementById('homeBtn'),
          fsBtn   = document.getElementById('fsBtn'),
          resetBtn= document.getElementById('resetBtn'),
          dotsEl  = document.getElementById('dots'),
          boardEl = document.getElementById('board');

    /***************** 전역 상태 *****************/
    let curKey = 'veryeasy', SIZE, MAX, sol, board, clicks;

    /***************** 레전드 빌드 *****************/
    (function buildLegend(){
      const colors = ['#ff0033','#ffd800','#00ff33','#0066ff'];
      for(let r=1;r<=4;r++){
        const wrap  = document.createElement('div');
        wrap.style.display='flex'; wrap.style.flexDirection='column'; wrap.style.alignItems='center';

        const grid  = document.createElement('div');
        grid.className='legend-block';
        for(let y=0;y<7;y++){
          for(let x=0;x<7;x++){
            const sq = document.createElement('div');
            sq.className='square';
            if(Math.abs(x-3)+Math.abs(y-3)<=r) sq.style.background = colors[r-1];
            grid.appendChild(sq);
          }
        }
        const cap = document.createElement('div');
        cap.className='legend-title'; cap.textContent = ['빨1','노2','초3','파4'][r-1];
        wrap.append(grid, cap);
        legend.appendChild(wrap);
      }
    })();

    /***************** 난이도 버튼 *****************/
    order.forEach(k => {
      const btn = document.createElement('button');
      btn.textContent = names[k];
      btn.className   = 'level-btn';
      btn.onclick     = () => { curKey = k; showGame(); };
      levels.appendChild(btn);
    });

    /***************** 화면 전환 *****************/
    function showMenu(){ menu.classList.add('active'); game.classList.remove('active'); }
    function showGame(){ initPuzzle(puzzles[curKey]); menu.classList.remove('active'); game.classList.add('active'); }

    /***************** 퍼즐 초기화 *****************/
    function initPuzzle(cfg){
      SIZE = cfg.size; MAX = cfg.max; sol = cfg.sol; clicks = 0;
      board = Array.from({length: SIZE}, () => Array(SIZE).fill(0));

      if(cfg.inf){
        // 무한 모드: 시작 색 파랑(c3)
        board.forEach(row => row.fill(3));
      } else {
        // 역연산으로 퍼즐 생성
        const radius = [1,2,3,4];
        const inverse = (r,c) => {
          const color = board[r][c], rad = radius[color];
          board[r][c] = (color + 3) % 4;
          for(let i=0;i<SIZE;i++){
            for(let j=0;j<SIZE;j++){
              if(Math.abs(i-r)+Math.abs(j-c) <= rad && !(i===r && j===c))
                board[i][j] = (board[i][j] + 3) % 4;
            }
          }
        };
        [...sol].reverse().forEach(([r,c]) => inverse(r,c));
      }

      buildDots();
      buildBoard();
    }

    /***************** UI 빌드 *****************/
    function buildDots(){
      dotsEl.innerHTML='';
      if(MAX < 1){ dotsEl.style.display='none'; return; }
      dotsEl.style.display='flex';
      for(let i=0;i<MAX;i++) dotsEl.appendChild(Object.assign(document.createElement('div'),{className:'dot'}));
    }
    function buildBoard(){
      boardEl.innerHTML='';
      boardEl.style.gridTemplateColumns = `repeat(${SIZE}, 60px)`;
      boardEl.style.gridAutoRows       = `60px`;

      for(let r=0;r<SIZE;r++){
        for(let c=0;c<SIZE;c++){
          const cell = document.createElement('div');
          cell.className = 'cell c'+board[r][c];
          cell.dataset.r = r; cell.dataset.c = c;
          cell.onclick   = cellClick;
          boardEl.appendChild(cell);
        }
      }
      renderBoard();
    }

    /***************** 게임 로직 *****************/
    function cellClick(e){
      if(MAX>0 && clicks>=MAX) return;
      const r = +e.target.dataset.r, c = +e.target.dataset.c;
      forward(r,c);
      clicks++;
      updateDots(); renderBoard();
      if(!puzzles[curKey].inf && isSolved()) setTimeout(()=>alert('Solved!'),10);
    }
    function forward(r,c){
      const color = board[r][c], rad = [1,2,3,4][color];
      board[r][c] = (color + 1) % 4;
      for(let i=0;i<SIZE;i++){
        for(let j=0;j<SIZE;j++){
          if(Math.abs(i-r)+Math.abs(j-c) <= rad && !(i===r && j===c))
            board[i][j] = (board[i][j] + 1) % 4;
        }
      }
    }
    function updateDots(){
      if(MAX < 1) return;
      const remaining = MAX - clicks;
      if(remaining >= 0 && dotsEl.children[remaining])
        dotsEl.children[remaining].style.visibility = 'hidden';
    }
    function renderBoard(){
      boardEl.querySelectorAll('.cell').forEach(cell => {
        const r = +cell.dataset.r, c = +cell.dataset.c;
        cell.className = 'cell c'+board[r][c];
      });
    }
    function isSolved(){
      return board.flat().every(v => v === board[0][0]);
    }
    function reset(){ initPuzzle(puzzles[curKey]); }

    /***************** 전체화면 *****************/
    function toggleFull(){
      if(!document.fullscreenElement){
        document.documentElement.requestFullscreen();
        fsBtn.textContent = '⤡';
      } else {
        document.exitFullscreen(); fsBtn.textContent = '⤢';
      }
    }

    /***************** 이벤트 바인딩 *****************/
    homeBtn.onclick  = showMenu;
    fsBtn.onclick    = toggleFull;
    resetBtn.onclick = reset;
    document.addEventListener('keydown', e => {
      if('fF'.includes(e.key)) toggleFull();
    });

    /***************** 초기 화면 *****************/
    showMenu();
  </script></body>
</html>
