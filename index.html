<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5×5 Rune Puzzle – 3 Random Clicks</title>
  <style>
    /* === 기본 레이아웃 === */
    html,body{margin:0;height:100%}
    body{background:#000;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;font-family:sans-serif}/* === 보드 === */
#board{display:grid;grid-template-columns:repeat(5,70px);grid-auto-rows:70px;gap:6px}
.cell{width:70px;height:70px;cursor:pointer;box-shadow:0 0 4px rgba(255,255,255,.15);transition:filter .1s}
.cell:hover{filter:brightness(1.2)}

/* 색상 */
.c0{background:#ff0033}.c1{background:#ffd800}.c2{background:#00ff33}.c3{background:#0066ff}

/* === 남은 클릭 표시 === */
#dots{display:flex;gap:8px}
.dot{width:14px;height:14px;background:#fff;border-radius:50%}

/* 버튼 */
button{padding:6px 14px;border:none;border-radius:4px;background:#444;color:#fff;cursor:pointer}
button:hover{background:#666}

  </style>
</head>
<body>
  <div id="dots"></div>
  <div id="board"></div>
  <button id="resetBtn">RESET</button><script>
/********************************************************
 * 5×5 Rune Puzzle (3‑step solution, spread randomly)   *
 *  좌표계: 왼쪽‑아래가 (1,1)                            *
 *  정답 순서: ① (2,4) → ② (5,1) → ③ (3,5)            *
 ********************************************************/

const SIZE = 5;
const MAX_CLICKS = 3;

// 0:R, 1:Y, 2:G, 3:B
const board = Array.from({length:SIZE},()=>Array(SIZE).fill(0));

// (col,row) → (rowIndex,colIndex) 0‑index 변환
// (2,4) ▶ (row1,col1) , (5,1) ▶ (row4,col4) , (3,5) ▶ (row0,col2)
const solutionClicks=[
  [1,1], // (2,4)
  [4,4], // (5,1)
  [0,2]  // (3,5)
];

// 색에 따른 반경 (빨4, 노1, 초2, 파3)
const radiusByColor=[4,1,2,3];

/* ---------- 역연산으로 초기 보드 생성 ---------- */
function inverseClick(row,col){
  const C0=board[row][col];
  const r=radiusByColor[C0];
  board[row][col]=(board[row][col]+3)%4; // 클릭 칸 -1
  for(let i=0;i<SIZE;i++){
    for(let j=0;j<SIZE;j++){
      if(i===row&&j===col) continue;
      if(Math.abs(i-row)+Math.abs(j-col)<=r){
        board[i][j]=(board[i][j]+3)%4;
      }
    }
  }
}

[...solutionClicks].reverse().forEach(([r,c])=>inverseClick(r,c));

/* ---------- DOM 구축 ---------- */
const boardEl=document.getElementById('board');
const dotsEl=document.getElementById('dots');
const resetBtn=document.getElementById('resetBtn');

function buildDots(){
  dotsEl.innerHTML='';
  for(let i=0;i<MAX_CLICKS;i++){
    const d=document.createElement('div');
    d.className='dot';
    dotsEl.appendChild(d);
  }
}

function buildBoard(){
  boardEl.innerHTML='';
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      const cell=document.createElement('div');
      cell.className='cell c'+board[r][c];
      cell.dataset.row=r;
      cell.dataset.col=c;
      cell.addEventListener('click',handleClick);
      boardEl.appendChild(cell);
    }
  }
}

/* ---------- 게임 로직 ---------- */
let clicks=0;

function forwardClick(row,col){
  const C0=board[row][col];
  const r=[1,2,3,4][C0];
  board[row][col]=(board[row][col]+1)%4;
  for(let i=0;i<SIZE;i++){
    for(let j=0;j<SIZE;j++){
      if(i===row&&j===col) continue;
      if(Math.abs(i-row)+Math.abs(j-col)<=r){
        board[i][j]=(board[i][j]+1)%4;
      }
    }
  }
}

function handleClick(e){
  if(clicks>=MAX_CLICKS) return;
  const row=+e.target.dataset.row,
        col=+e.target.dataset.col;
  forwardClick(row,col);
  clicks++;
  updateDots();
  renderBoard();
  if(isSolved()) setTimeout(()=>alert('Solved!'),10);
}

function isSolved(){
  const first=board[0][0];
  return board.flat().every(v=>v===first);
}

function renderBoard(){
  document.querySelectorAll('.cell').forEach(cell=>{
    const r=+cell.dataset.row,
          c=+cell.dataset.col;
    cell.className='cell c'+board[r][c];
  });
}

function updateDots(){
  const dots=[...dotsEl.children];
  if(clicks<=MAX_CLICKS && dots[MAX_CLICKS-clicks]){
    dots[MAX_CLICKS-clicks].style.visibility='hidden';
  }
}

/* ---------- RESET ---------- */
function resetGame(){
  for(let r=0;r<SIZE;r++) board[r].fill(0);
  [...solutionClicks].reverse().forEach(([r,c])=>inverseClick(r,c));
  clicks=0;
  buildDots();
  renderBoard();
}

resetBtn.addEventListener('click',resetGame);

/* ---------- 초기 실행 ---------- */
buildDots();
buildBoard();
</script></body>
</html>
