<script>
const puzzles={
  veryeasy:{size:7,max:2,sol:[[6,0],[0,6]]},
  normal  :{size:5,max:3,sol:[[1,1],[4,4],[0,2]]},
  hard    :{size:5,max:5,sol:[[2,1],[3,0],[0,4],[4,3],[1,2]]},
  extreme :{size:7,max:5,sol:[[5,5],[3,2],[0,6],[2,1],[4,4]]},
  impossible:{size:9,max:7,sol:[[8,0],[6,2],[4,4],[2,6],[0,8],[5,5],[3,3]]},
  infinite:{size:7,max:0,sol:[],inf:true}
};
const order=['veryeasy','normal','hard','extreme','impossible','infinite'];
const names={veryeasy:'매우쉬움',normal:'보통',hard:'상',extreme:'극상',impossible:'불가능',infinite:'무한'};
const menu=document.getElementById('menu'),game=document.getElementById('game'),legend=document.getElementById('legend'),levels=document.getElementById('levels'),homeBtn=document.getElementById('homeBtn'),resetBtn=document.getElementById('resetBtn'),dotsEl=document.getElementById('dots'),boardEl=document.getElementById('board');
let cur='veryeasy',SIZE,MAX,sol,board,clicks;

// 여기에 오디오 객체를 추가합니다.
// 'SOUND.mp3'는 HTML 파일과 같은 경로에 있다고 가정합니다.
const solveSound = new Audio('SOUND.mp3');

(function(){const colors=['#ff0033','#ffd800','#00ff33','#0066ff'],radii=[1,2,3,4],N=9,center=4;for(let i=0;i<4;i++){const wrap=document.createElement('div');wrap.style.display='flex';wrap.style.flexDirection='column';wrap.style.alignItems='center';const grid=document.createElement('div');grid.className='legend-block';for(let y=0;y<N;y++)for(let x=0;x<N;x++){const sq=document.createElement('div');sq.className='square';if(Math.abs(x-center)+Math.abs(y-center)<=radii[i])sq.style.background=colors[i];grid.appendChild(sq);}const cap=document.createElement('div');cap.className='legend-title';cap.textContent=['빨4','노1','초2','파3'][i];wrap.append(grid,cap);legend.appendChild(wrap);} })();
function buildLevels(){levels.innerHTML='';order.forEach(k=>{const b=document.createElement('button');b.textContent=names[k];b.className='level-btn';b.onclick=()=>{cur=k;showGame();};levels.appendChild(b);});}
function showMenu(){menu.classList.add('active');game.classList.remove('active');}
function showGame(){init(puzzles[cur]);menu.classList.remove('active');game.classList.add('active');}
function init(cfg){SIZE=cfg.size;MAX=cfg.max;sol=cfg.sol;clicks=0;board=Array.from({length:SIZE},()=>Array(SIZE).fill(0));if(cfg.inf){board.forEach(r=>r.fill(3));}else{const rad=[4,1,2,3];const inv=(r,c)=>{const col=board[r][c],rv=rad[col];board[r][c]=(col+3)%4;for(let i=0;i<SIZE;i++)for(let j=0;j<SIZE;j++)if(Math.abs(i-r)+Math.abs(j-c)<=rv&&(i!==r||j!==c))board[i][j]=(board[i][j]+3)%4;};[...sol].reverse().forEach(([r,c])=>inv(r,c));}buildDots();buildBoard();}
function buildDots(){dotsEl.innerHTML='';if(MAX<1){dotsEl.style.display='none';return;}dotsEl.style.display='flex';for(let i=0;i<MAX;i++){const d=document.createElement('div');d.className='dot';dotsEl.appendChild(d);}}
function buildBoard(){boardEl.innerHTML='';boardEl.style.gridTemplateColumns=`repeat(${SIZE},60px)`;boardEl.style.gridAutoRows='60px';for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){const cell=document.createElement('div');cell.className='cell c'+board[r][c];cell.dataset.r=r;cell.dataset.c=c;cell.onclick=clickCell;boardEl.appendChild(cell);}render();}
function clickCell(e){if(MAX>0&&clicks>=MAX)return;const r=+e.target.dataset.r,c=+e.target.dataset.c;advance(r,c);clicks++;updateDots();render();if(MAX>0&&!puzzles[cur].inf&&solved()){
    solveSound.play(); 
    setTimeout(()=>alert('Solved!'),10);
}}
function advance(r,c){const col=board[r][c],rv=[1,2,3,4][col];board[r][c]=(col+1)%4;for(let i=0;i<SIZE;i++)for(let j=0;j<SIZE;j++)if(Math.abs(i-r)+Math.abs(j-c)<=rv&&(i!==r||j!==c))board[i][j]=(board[i][j]+1)%4;}
function updateDots(){if(MAX<1)return;if(dotsEl.children[MAX-clicks])dotsEl.children[MAX-clicks].style.visibility='hidden';}
function render(){boardEl.querySelectorAll('.cell').forEach(cell=>{const r=+cell.dataset.r,c=+cell.dataset.c;cell.className='cell c'+board[r][c];});}
function solved(){return board.flat().every(v=>v===board[0][0]);}
resetBtn.onclick=()=>init(puzzles[cur]);homeBtn.onclick=showMenu;
buildLevels();showMenu();
</script>
