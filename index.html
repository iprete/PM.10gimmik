<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rune Puzzle – 난이도 선택</title>
  <style>
    /* ===== 기본 레이아웃 ===== */
    html,body{margin:0;height:100%}
    body{background:#000;color:#fff;font-family:sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center}/* ===== 공통 ===== */
.view{display:none;flex-direction:column;align-items:center;gap:32px}
#menu.view{display:flex}

/* 메뉴 */
#menu h1{font-size:2.6rem;margin:0}
.rules{font-size:0.95rem;text-align:center;line-height:1.4;opacity:0.9}
.level-container{display:flex;gap:28px;flex-wrap:wrap;justify-content:center}
.level-btn{min-width:140px;height:70px;font-size:1.2rem;border:none;border-radius:8px;cursor:pointer;background:#222;color:#fff}
.level-btn:hover{background:#444}

/* 레전드 */
#legend{display:flex;gap:24px;margin-top:12px}
.legend-block{display:grid;grid-template-columns:repeat(7,10px);grid-auto-rows:10px;gap:1px}
.legend-block>.square{width:10px;height:10px;background:#333}
.legend-title{text-align:center;font-size:0.8rem;margin-top:4px;opacity:0.8}

/* 게임 화면 */
#game{gap:24px;position:relative}
#homeBtn,#fsBtn{position:absolute;top:-50px;padding:6px 12px;border:none;border-radius:4px;background:#444;color:#fff;cursor:pointer}
#homeBtn:hover,#fsBtn:hover{background:#666}
#homeBtn{left:0}
#fsBtn{right:0}
#resetBtn{padding:6px 14px;border:none;border-radius:4px;background:#444;color:#fff;cursor:pointer}
#resetBtn:hover{background:#666}

/* 보드 및 셀 */
#board{display:grid;gap:6px}
.cell{width:60px;height:60px;cursor:pointer;box-shadow:0 0 4px rgba(255,255,255,.15);transition:filter .1s}
.cell:hover{filter:brightness(1.2)}
.c0{background:#ff0033}.c1{background:#ffd800}.c2{background:#00ff33}.c3{background:#0066ff}

/* 클릭 잔여 표시 */
#dots{display:flex;gap:8px}
.dot{width:14px;height:14px;background:#fff;border-radius:50%}

  </style>
</head>
<body>
  <!-- ===== 난이도 선택 화면 ===== -->
  <div id="menu" class="view">
    <h1>난이도 선택</h1>
    <div class="rules">
      <strong>규칙</strong> : 셀을 클릭하면<br>
      — 해당 칸이 <em>빨 → 노 → 초 → 파 → 빨</em> 순으로 변하고,<br>
      — 동시에 <em>맨해튼 거리</em> ≤ 색마다 지정된 반경의 주변 칸도 같이 변합니다.<br>
      &nbsp;&nbsp;• 빨강 1&nbsp;&nbsp;• 노랑 2&nbsp;&nbsp;• 초록 3&nbsp;&nbsp;• 파랑 4<br>
      남은 클릭 수는 위 점(dot)으로 표시되며,<br>
      모든 칸 색이 같아지면 퍼즐이 해결됩니다.
    </div><!-- 색별 반경 시각 예시 -->
<div id="legend"></div>

<!-- 난이도 버튼 -->
<div class="level-container">
  <button id="veryEasyBtn" class="level-btn">매우쉬움</button>
  <button id="normalBtn"    class="level-btn">보통</button>
  <button id="hardBtn"      class="level-btn">상</button>
  <button id="extremeBtn"   class="level-btn">극상</button>
  <button id="infiniteBtn"  class="level-btn">무한</button>
</div>

  </div>  <!-- ===== 게임 화면 ===== -->  <div id="game" class="view">
    <button id="homeBtn">HOME</button>
    <button id="fsBtn">⤢</button>
    <div id="dots"></div>
    <div id="board"></div>
    <button id="resetBtn">RESET</button>
  </div><script>
/***************** 퍼즐 정의 *****************/
const puzzles = {
  veryeasy : { size:7, maxClicks:2, solutionClicks:[[6,0],[0,6]] },
  normal   : { size:5, maxClicks:3, solutionClicks:[[1,1],[4,4],[0,2]] },
  hard     : { size:5, maxClicks:5, solutionClicks:[[2,1],[3,0],[0,4],[4,3],[1,2]] },
  extreme  : { size:7, maxClicks:5, solutionClicks:[[5,5],[3,2],[0,6],[2,1],[4,4]] },
  infinite : { size:7, maxClicks:0, solutionClicks:[], infinite:true }
};

/***************** 상태 변수 *****************/
let SIZE, MAX_CLICKS, solutionClicks, board, currentDifficulty;
let clicks = 0;

/***************** DOM 참조 *****************/
const menuView   = document.getElementById('menu');
const gameView   = document.getElementById('game');
const veryEasyBtn= document.getElementById('veryEasyBtn');
const normalBtn  = document.getElementById('normalBtn');
const hardBtn    = document.getElementById('hardBtn');
const extremeBtn = document.getElementById('extremeBtn');
const infiniteBtn= document.getElementById('infiniteBtn');
const homeBtn    = document.getElementById('homeBtn');
const fsBtn      = document.getElementById('fsBtn');
const boardEl    = document.getElementById('board');
const dotsEl     = document.getElementById('dots');
const resetBtn   = document.getElementById('resetBtn');
const legendEl   = document.getElementById('legend');

/***************** 레전드 생성 *****************/
(function buildLegend(){
  const colors=['#ff0033','#ffd800','#00ff33','#0066ff'];
  const radii =[1,2,3,4];
  radii.forEach((r,idx)=>{
    const block=document.createElement('div');
    block.className='legend-block';
    for(let y=0;y<7;y++){
      for(let x=0;x<7;x++){
        const sq=document.createElement('div');
        sq.className='square';
        if(Math.abs(x-3)+Math.abs(y-3)<=r){ sq.style.background=colors[idx]; }
        block.appendChild(sq);
      }
    }
    const wrapper=document.createElement('div');
    wrapper.style.display='flex';wrapper.style.flexDirection='column';wrapper.style.alignItems='center';
    wrapper.appendChild(block);
    const title=document.createElement('div');title.className='legend-title';title.textContent=['빨 1','노 2','초 3','파 4'][idx];
    wrapper.appendChild(title);
    legendEl.appendChild(wrapper);
  });
})();

/***************** 공통 함수 *****************/
function show(view){
  menuView.style.display = view==='menu' ? 'flex' : 'none';
  gameView.style.display = view==='game' ? 'flex' : 'none';
}

function initPuzzle(cfg){
  SIZE = cfg.size;  MAX_CLICKS = cfg.maxClicks;  solutionClicks = cfg.solutionClicks;
  board = Array.from({length:SIZE},()=>Array(SIZE).fill(0));
  if(cfg.infinite){
    for(let r=0;r<SIZE;r++) board[r].fill(3);
  } else {
    const radiusByColor=[1,2,3,4];
    const inverseClick=(row,col)=>{
      const C0=board[row][col]; const r=radiusByColor[C0];
      board[row][col]=(board[row][col]+3)%4;
      for(let i=0;i<SIZE;i++)for(let j=0;j<SIZE;j++){
        if(i===row&&j===col) continue;
        if(Math.abs(i-row)+Math.abs(j-col)<=r){ board[i][j]=(board[i][j]+3)%4; }
      }
    };
    [...solutionClicks].reverse().forEach(([r,c])=>inverseClick(r,c));
  }
  clicks=0; buildDots(); buildBoard();
}

/***************** 보드 & UI *****************/
function buildDots(){
  if(MAX_CLICKS<1){ dotsEl.style.display='none'; return; }
  dotsEl.style.display='flex'; dotsEl.innerHTML='';
  for(let i=0;i<MAX_CLICKS;i++){ const d=document.createElement('div'); d.className='dot'; dotsEl.appendChild(d); }
}
function buildBoard(){
  boardEl.innerHTML=''; const cs=60;
  boardEl.style.gridTemplateColumns=`repeat(${SIZE},${cs}px)`;
  boardEl.style.gridAutoRows=`${cs}px`;
  for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){ const cell=document.createElement('div');cell.className='cell c'+board[r][c];cell.dataset.row=r;cell.dataset.col=c;cell.addEventListener('click',handleClick);boardEl.appendChild(cell);} }
function forwardClick(r,c){ const C0=board[r][c]; const radius=[1,2,3,4][C0]; board[r][c]=(board[r][c]+1)%4; for(let i=0;i<SIZE;i++)for(let j=0;j<SIZE;j++){ if(i===r&&j===c) continue; if(Math.abs(i-r)+Math.abs(j-c)<=radius){ board[i][j]=(board[i][j]+1)%4; } } }
function handleClick(e){ if(MAX_CLICKS>0&&clicks>=MAX_CLICKS) return; const r=+
